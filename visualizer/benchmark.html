<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neural Operator Benchmark</title>
    <!-- Fuentes estilo LaTeX -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Latin+Modern+Roman&family=Latin+Modern+Mono&display=swap"
    />
    <style>
        /* Reset */
        * { margin:0; padding:0; box-sizing:border-box; }

        /* Body */
        body {
            font-family:"Latin Modern Roman", serif;
            background:#f5f7fa;
            color:#2a2a40;
            line-height:1.6;
            padding:20px;
        }

        /* Headings */
        h1 {
            font-size:2.8em; text-align:center;
            background:linear-gradient(90deg,#3f51b5,#5c6bc0);
            color:#fff; padding:0.5em 0; border-radius:4px;
            margin-bottom:1em;
        }
        h2 {
            font-size:1.8em; color:#3f51b5;
            margin-top:2em; padding-bottom:0.2em;
            border-bottom:2px solid #3f51b5;
        }
        h3 {
            font-size:1.3em; color:#3f51b5;
            margin-bottom:0.5em;
        }
        .subtitle {
            text-align:center; color:#5a5f6d;
            margin-bottom:2em; font-style:italic;
        }

        /* Sections & Cards */
        .section {
            background:#fff; border-radius:6px;
            padding:1.5em; box-shadow:0 4px 8px rgba(0,0,0,0.05);
            margin-bottom:2em;
        }
        .grid {
            display:flex; flex-wrap:wrap; gap:1.5em;
        }
        .card {
            flex:1 1 300px; background:#fff;
            border-left:4px solid transparent;
            padding:1.2em; border-radius:4px;
            position:relative; box-shadow:0 2px 6px rgba(0,0,0,0.04);
            transition:transform 0.2s,box-shadow 0.2s;
        }
        .card::before {
            content:""; position:absolute;
            top:0; left:0; bottom:0; width:4px;
            background:linear-gradient(180deg,#3f51b5,#5c6bc0);
            border-radius:4px 0 0 4px;
        }
        .card:hover {
            transform:translateY(-4px);
            box-shadow:0 8px 16px rgba(0,0,0,0.08);
        }

        /* Alerts */
        .loading, .error {
            border-radius:6px; padding:1em 1.2em;
            margin:1em 0; box-shadow:0 2px 6px rgba(0,0,0,0.1);
            font-family:"Latin Modern Roman", serif;
        }
        .loading {
            background:#eef2ff; border-left:4px solid #3f51b5;
            color:#2a3d66;
        }
        .error {
            background:#ffebeb; border-left:4px solid #c0392b;
            color:#641e16;
        }

        /* Accuracy note */
        .accuracy-note {
            background:#eef3ff; border-left:4px solid #3f51b5;
            padding:1em; margin:1.5em 0; font-size:0.9em;
        }
        .accuracy-note h4 {
            margin-bottom:0.5em; color:#3f51b5;
            font-style:normal;
        }

        /* Tables */
        table {
            width:100%; border-collapse:collapse;
            margin-top:1em; font-size:0.95em; background:#fff;
        }
        thead tr { border-bottom:2px solid #3f51b5; }
        th, td {
            padding:0.6em 0.8em; text-align:left;
        }
        tbody tr:nth-child(odd) { background:#f9fbff; }
        tbody tr:hover { background:#e8f0fb; }
        tbody tr + tr { border-top:1px solid #dde4f2; }
        th {
            font-family:"Latin Modern Roman", serif;
            font-weight:normal; color:#3f51b5;
        }
        td {
            font-family:"Latin Modern Mono", monospace;
            color:#2a2a40;
        }

        /* Charts ‚Äì espacio extra arriba y a la izquierda */
        .chart-container {
            background:#fff; border:1px solid #dde4f2;
            border-radius:4px; padding:2em 1em 1em 80px;
            /* padding: top right bottom left */
            box-shadow:0 2px 6px rgba(0,0,0,0.04);
        }
        canvas { width:100%; height:400px; display:block; }

        /* Predictions */
        .image-grid {
            display:flex; flex-direction:column; gap:1.5em;
            margin-top:1em;
        }
        .model-image {
            width:100%; text-align:center;
        }
        .model-image img {
            width:70%; height:auto;
            border:1px solid #dde4f2; border-radius:4px;
            box-shadow:0 2px 6px rgba(0,0,0,0.04);
        }

        /* Info labels */
        .info-label {
            font-style:italic; color:#5a5f6d;
            font-size:0.9em; width:120px; display:inline-block;
        }
        .info-value {
            font-family:"Latin Modern Mono", monospace;
            color:#2a2a40;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Neural Operator Benchmark</h1>
        <p class="subtitle" id="timestamp">Loading results‚Ä¶</p>

        <div id="loading" class="loading">üìä Loading benchmark results‚Ä¶</div>
        <div id="error" class="error" style="display:none;"></div>

        <div id="content" style="display:none;">
            <!-- Benchmark Configuration -->
            <div class="section">
                <h2>Benchmark Configuration</h2>
                <div class="grid">
                    <div class="card">
                        <h3>Environment</h3>
                        <div class="info-item">
                            <span class="info-label">Device:</span>
                            <span class="info-value" id="device"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Epochs:</span>
                            <span class="info-value" id="epochs"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Timestamp:</span>
                            <span class="info-value" id="run-timestamp"></span>
                        </div>
                    </div>
                    <div class="card">
                        <h3>Dataset: <span id="dataset-name"></span></h3>
                        <div class="info-item">
                            <span class="info-label">Description:</span>
                            <span class="info-value" id="dataset-desc"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Equation:</span>
                            <span class="info-value" id="dataset-eq"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Grid Res.:</span>
                            <span class="info-value" id="grid-res"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Train Samples:</span>
                            <span class="info-value" id="n-train"></span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Test Samples:</span>
                            <span class="info-value" id="n-test"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Accuracy Calculation Note -->
            <div id="accuracy-note" class="accuracy-note" style="display:none;">
                <h4>‚ö†Ô∏è Accuracy Calculation Method</h4>
                <p id="accuracy-method"></p>
            </div>

            <!-- Model Architectures -->
            <div class="section">
                <h2>Model Architectures</h2>
                <div id="model-cards" class="grid"></div>
            </div>

            <!-- Performance Comparison -->
            <div class="section">
                <h2>Performance Comparison</h2>
                <table id="metrics-table">
                    <thead>
                        <tr>
                            <th>Model</th>
                            <th>MSE ‚Üì</th>
                            <th>MAE ‚Üì</th>
                            <th>Relative L2 ‚Üì</th>
                            <th>Accuracy ‚Üë</th>
                            <th>Training Time (s)</th>
                            <th>Time/Epoch (s)</th>
                            <th>Parameters</th>
                        </tr>
                    </thead>
                    <tbody id="metrics-body"></tbody>
                </table>
            </div>

            <!-- Training & Validation Accuracy Curves -->
            <div class="section">
                <h2>Training &amp; Validation Accuracy Curves</h2>
                <div class="chart-container">
                    <img id="trainingCurvesChart" src="./fno_charts/training_curves.png" 
                         alt="Training and Validation Accuracy Curves" 
                         style="width: 100%; height: auto; max-height: 500px; object-fit: contain;"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <div style="display: none; text-align: center; padding: 2em; color: #888; background: #f9f9f9; border-radius: 4px;">
                        üìä Training curves chart not available<br>
                        <small>Run the matplotlib visualizer to generate charts</small>
                    </div>
                </div>
            </div>

            <!-- Performance Analysis Charts -->
            <div class="section">
                <h2>Performance Analysis</h2>
                <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 2em;">
                    <!-- Training Time vs Accuracy -->
                    <div class="card">
                        <h3>Training Time vs Accuracy</h3>
                        <div class="chart-container" style="padding: 1em;">
                            <img src="./fno_charts/training_time_vs_accuracy.png" 
                                 alt="Training Time vs Accuracy" 
                                 style="width: 100%; height: auto; max-height: 350px; object-fit: contain;"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <div style="display: none; text-align: center; padding: 1.5em; color: #888; background: #f9f9f9; border-radius: 4px;">
                                üìä Chart not available
                            </div>
                        </div>
                    </div>

                    <!-- Relative L2 Error -->
                    <div class="card">
                        <h3>Relative L2 Error Comparison</h3>
                        <div class="chart-container" style="padding: 1em;">
                            <img src="./fno_charts/relative_l2_error.png" 
                                 alt="Relative L2 Error Comparison" 
                                 style="width: 100%; height: auto; max-height: 350px; object-fit: contain;"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <div style="display: none; text-align: center; padding: 1.5em; color: #888; background: #f9f9f9; border-radius: 4px;">
                                üìä Chart not available
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Model Efficiency Analysis -->
            <div class="section">
                <h2>Model Efficiency Analysis</h2>
                <div class="chart-container">
                    <img src="./fno_charts/model_efficiency.png" 
                         alt="Model Efficiency - Accuracy per 1000 Parameters" 
                         style="width: 100%; height: auto; max-height: 500px; object-fit: contain;"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <div style="display: none; text-align: center; padding: 2em; color: #888; background: #f9f9f9; border-radius: 4px;">
                        üìä Model efficiency chart not available<br>
                        <small>This chart shows accuracy per 1000 parameters - higher values indicate more efficient models</small>
                    </div>
                </div>
                <div style="margin-top: 1em; padding: 1em; background: #f0f4ff; border-left: 4px solid #3f51b5; border-radius: 4px;">
                    <h4 style="margin-bottom: 0.5em; color: #3f51b5;">üí° Understanding Model Efficiency</h4>
                    <p style="margin: 0; color: #2a3d66; font-size: 0.95em;">
                        This metric shows how much accuracy each model achieves per 1000 parameters. 
                        Higher values indicate more parameter-efficient models that achieve better performance 
                        with fewer parameters. This is especially important for deployment scenarios with 
                        memory or computational constraints.
                    </p>
                </div>
            </div>

            <!-- Sample Predictions -->
            <div class="section">
                <h2>Sample Predictions</h2>
                <div id="predictions" class="image-grid"></div>
            </div>
        </div>
    </div>

    <script>
        function safeGet(obj, path, def=0) {
            return path.split('.').reduce((o,k)=>(o&&o[k]!=null)?o[k]:def, obj);
        }

        async function loadResults() {
            try {
                const res = await fetch('./benchmark_results.json');
                if (!res.ok) throw new Error('Failed to load data');
                const data = await res.json();
                displayResults(data);
            } catch (e) {
                document.getElementById('loading').style.display='none';
                const err = document.getElementById('error');
                err.style.display='block';
                err.textContent = `Error Loading Results: ${e.message}`;
            }
        }

        function displayResults(d) {
            document.getElementById('loading').style.display='none';
            document.getElementById('content').style.display='block';

            const ts = new Date(d.timestamp);
            document.getElementById('timestamp').textContent = `Results from ${ts.toLocaleString()}`;
            document.getElementById('device').textContent = d.device||'‚Äì';
            document.getElementById('epochs').textContent = d.epochs||'‚Äì';
            document.getElementById('run-timestamp').textContent = ts.toLocaleString();

            const ds = d.dataset_info||{};
            document.getElementById('dataset-name').textContent = ds.name||'‚Äì';
            document.getElementById('dataset-desc').textContent = ds.description||'‚Äì';
            document.getElementById('dataset-eq').textContent = ds.equation||'‚Äì';
            document.getElementById('grid-res').textContent = ds.grid_resolution||'‚Äì';
            document.getElementById('n-train').textContent = ds.n_train_samples||'‚Äì';
            document.getElementById('n-test').textContent = ds.n_test_samples||'‚Äì';

            if (d.accuracy_calculation_note) {
                document.getElementById('accuracy-note').style.display='block';
                document.getElementById('accuracy-method').textContent = d.accuracy_calculation_note;
            }

            const mc = document.getElementById('model-cards');
            mc.innerHTML = '';
            d.models.forEach(m=>{
                const info = m.model_info||{};
                const arch = info.architecture||{};
                let details='';
                Object.entries(arch).forEach(([k,v])=>{
                    if(k!=='type' && v!=null) {
                        details+=`<div class="info-item"><span class="info-label">${k.replace(/_/g,' ')}:</span><span class="info-value">${v}</span></div>`;
                    }
                });
                const card = document.createElement('div');
                card.className='card';
                card.innerHTML=`
                    <h3>${info.name||m.name}</h3>
                    <p style="color:#888;font-style:italic">${arch.type||''}</p>
                    <div class="info-item"><span class="info-label">Parameters:</span><span class="info-value">${(info.parameters||0).toLocaleString()}</span></div>
                    <div class="info-item"><span class="info-label">Optimizer:</span><span class="info-value">${info.optimizer||'‚Äì'}</span></div>
                    ${details}
                `;
                mc.appendChild(card);
            });

            fillMetrics(d.models);

            // Charts are now handled by matplotlib images, no need for canvas drawing

            const pred = document.getElementById('predictions');
            pred.innerHTML = '';
            d.models.forEach(m=>{
                const div = document.createElement('div');
                div.className='model-image';
                div.innerHTML=`
                    <h3>${m.name}</h3>
                    <img src="${m.plot_path}" alt="${m.name}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22300%22><rect fill=%22%23333%22 width=%22400%22 height=%22300%22/><text x=%2250%%22 y=%2250%%22 fill=%22%23888%22 text-anchor=%22middle%22>Image not found</text></svg>'">
                `;
                pred.appendChild(div);
            });
        }

        function fillMetrics(models) {
            const tb = document.getElementById('metrics-body');
            tb.innerHTML = '';
            const best = {};
            ['mse','mae','relative_l2','accuracy'].forEach(metric=>{
                const vals = models.map(m=>{
                    const mm=m.metrics||{};
                    if(metric==='relative_l2') return mm.relative_l2!=null?mm.relative_l2:mm.rel_l2||Infinity;
                    if(metric==='accuracy') return mm.accuracy!=null?mm.accuracy:-Infinity;
                    return mm[metric]!=null?mm[metric]:Infinity;
                });
                best[metric] = metric==='accuracy'?Math.max(...vals):Math.min(...vals);
            });
            models.forEach(m=>{
                const mm = m.metrics||{};
                const row = document.createElement('tr');
                const fmt=(v,p)=>(typeof v==='number'?v.toFixed(p):v);
                row.innerHTML=`
                    <td>${m.name}</td>
                    <td style="color:${mm.mse===best.mse?'#3f51b5':'inherit'}">${fmt(mm.mse,3)}</td>
                    <td style="color:${mm.mae===best.mae?'#3f51b5':'inherit'}">${fmt(mm.mae,3)}</td>
                    <td style="color:${(mm.relative_l2||mm.rel_l2)===best.relative_l2?'#3f51b5':'inherit'}">${fmt(mm.relative_l2||mm.rel_l2,4)}</td>
                    <td style="color:${mm.accuracy===best.accuracy?'#3f51b5':'inherit'}">${fmt(mm.accuracy,1)}%</td>
                    <td>${fmt(mm.wall_sec,2)}</td>
                    <td>${fmt(mm.avg_time_per_epoch,3)}</td>
                    <td>${safeGet(m,'model_info.parameters',0).toLocaleString()}</td>
                `;
                tb.appendChild(row);
            });
        }

        window.addEventListener('load', loadResults);
    </script>
</body>
</html>